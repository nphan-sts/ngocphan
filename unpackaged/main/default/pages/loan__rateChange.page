<apex:page lightningStylesheets="true" id="rateChangePage" standardController="loan__Loan_Account__c"
    extensions="loan.RateChangeController" tabStyle="loan__Loan_Account__c"
    sidebar="{!IF($CurrentPage.Parameters.modal == 'true', false, true)}"
    title="Rate Change">
<apex:include pageName="clcommon__mintTheme"/>

    <apex:stylesheet value="{!IF($CurrentPage.Parameters.modal == 'true', $Resource.loan__modalheaderStyle,'')}" />
    <apex:stylesheet value="{!$Resource.loan__HelpLink_CSS}" />
    <script type= "text/javascript" src="{!$Resource.ShowPage_JS}"/>
    <script
        src="{!URLFOR($Resource.jQueryFiles, 'js/jquery-1.8.3.min.js')}" />
    <script src="{!URLFOR($Resource.helperclose)}" />
    <script>
      j$ = jQuery.noConflict();
 	</script>

    <apex:sectionHeader title="Interest Rate Change" id="rateChangeSection" />
    <apex:form id="interestRateChangeForm">

        <apex:pageBlock mode="edit" id="rateChangeTxn">
            <apex:pageMessages />
            <apex:pageBlockButtons location="both">
                <c:BusyButton name="Save" busyName="Saving" actionTo="{!save}"
                    disabled="{!(otherLoanTxn.Id != null)}"
                    oncomplete="({!closeModal}===true) ? closeIframe('{!loanAccount.Id}') : {};"
                    reRenderTo="interestRateChangeForm" style="margin-left:120px;" />
                <apex:commandButton value="Cancel" action="{!cancel}"
                    onclick="closeIframe()" immediate="true" />
            </apex:pageBlockButtons>
            <apex:outputpanel styleClass="mint-lightning-wrapper mint-lightning-wrapper-center">
            <apex:pageBlockSection title="Loan Details" columns="2"
                rendered="{!(otherLoanTxn.Id == null)}">
                <apex:outputField value="{!loanAccount.Name}" />
                <apex:outputField value="{!otherLoanTxn.loan__Txn_Date__c}" />
                <apex:outputField value="{!loanAccount.loan__Interest_Rate__c}" />
                <apex:outputField value="{!loanAccount.loan__Interest_Rate_Change_Method__c}" />
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Parameters" columns="2"
                rendered="{!(otherLoanTxn.Id == null && loanAccount.loan__Interest_Calculation_Method__c != 'Flexible Repayment' && loanAccount.loan__Interest_Type__c != 'Floating')}">
                <apex:inputField value="{!otherLoanTxn.loan__New_Interest_Rate__c}" required="true"/>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Transaction Detail" columns="2"
                rendered="{!(otherLoanTxn.Id != null)}">
                <apex:outputField value="{!otherLoanTxn.loan__Loan_Account__c}" />
                <apex:outputField value="{!otherLoanTxn.loan__Transaction_Type__c}" />
                <apex:outputField value="{!otherLoanTxn.loan__Txn_Date__c}" />
                <apex:outputField value="{!otherLoanTxn.loan__New_Interest_Rate__c}" />
            </apex:pageBlockSection>
            <apex:pageBlockSection columns="1" id="flexibleRateScheduleBlock" collapsible="true" title=" Rate Schedule"
                                   rendered="{!(loanAccount.loan__Interest_Calculation_Method__c == 'Flexible Repayment' || loanAccount.loan__Interest_Type__c == 'Floating')}"
                                   >
                <c:RateSchedule rateScheduleList="{!rateSchedule}"
                                deletedRateScheduleList="{!deletedRateSchedules}"
                                resetAction="{!resetRateSchedule}"
                                validateSchedules="{!validateSchedules}"
                                paymentStartDate="{!loanAccount.loan__Expected_Disbursal_Date__c}"
                                rescheduleDate="{!otherLoanTxn.loan__Txn_Date__c}"
                                interestRate="{!loan__Loan_Account__c.loan__Interest_Rate__c}"
                                paymentFrequency="{!loan__Loan_Account__c.loan__Frequency_of_Loan_Payment__c}"
                                loanAccount="{!loanAccount}"
                                showButtons="Add,CustomValidation,Clear,Reset"
                                allowEdit="true"/>
            </apex:pageBlockSection>
            </apex:outputpanel>
        </apex:pageBlock>
    </apex:form>

</apex:page>