<apex:page lightningStylesheets="true" standardController="loan__Loan_Account__c"
    extensions="loan.LoanRefundController"
    sidebar="{!IF($CurrentPage.Parameters.modal == 'true', false, true)}">
<apex:include pageName="clcommon__mintTheme"/>

    <apex:stylesheet value="{!IF($CurrentPage.Parameters.modal == 'true', $Resource.loan__modalheaderStyle,'')}" />
    <apex:stylesheet value="{!$Resource.loan__HelpLink_CSS}" />
    <script type= "text/javascript" src="{!$Resource.ShowPage_JS}"/>
    <script
        src="{!URLFOR($Resource.jQueryFiles, 'js/jquery-1.8.3.min.js')}" />
    <script src="{!URLFOR($Resource.helperclose)}" />
    <script>
        j$ = jQuery.noConflict();
        
    </script>
    <script>
        function confirmCancel() {
            var isConfirm = confirm("Are you sure you want to cancel?");
            if(isConfirm){
                return this.parent.parent.window.close();
            }
        }
    </script>
    
    <apex:sectionHeader title="Refund against the loan: {!loan__Loan_Account__c.Name}" />
    <apex:outputPanel >
        <div style="height:300px">
            <apex:form id="refundForm">
                <apex:pageBlock id="refundPBId" mode="edit">
                    <apex:pageMessages />
                    <apex:pageBlockButtons location="both">
                        <c:BusyButton name="Save" busyName="Saving"
                            actionTo="{!refundLoan}" disabled="{!refundTxn.Id != null}"
                            oncomplete="({!closeModal}===true) ? closeIframe('{!refundTxn.loan__Loan_Account__c}') : {};"
                            reRenderTo="refundForm" style="margin-left:120px;" />
                        <apex:commandButton value="Cancel" immediate="true"
                            action="{!URLFOR($Action.Loan_Account__c.View,Loan_Account__c.Id)}"
                            onclick="closeIframe()" />
                    </apex:pageBlockButtons>
                    <apex:outputpanel id="refundLoanPanel" styleClass="mint-lightning-wrapper mint-lightning-wrapper-center">
                        <apex:pageBlockSection columns="2"
                            id="loanTermsPanelPageBlockSection" title="Enter Refund Amount">
                            <apex:inputField id="refundAmountId"
                                value="{!refundTxn.loan__Txn_Amt__c}" required="True" />
                            <apex:outputField id="loanExcessId"
                                value="{!loan__Loan_Account__c.loan__Excess__c}" />
                        </apex:pageBlockSection>
    
                        <apex:pageBlockSection title="Transaction Detail" columns="2"
                            rendered="{!(refundTxn.Id != null)}">
                            <apex:outputField value="{!refundTxn.loan__Loan_Account__c}" />
                            <apex:outputField value="{!refundTxn.loan__Txn_Amt__c}" />
                            <apex:outputField value="{!refundTxn.loan__Txn_Date__c}" />
                        </apex:pageBlockSection>
                    </apex:outputpanel>
                </apex:pageBlock>
            </apex:form>
        </div>
    </apex:outputPanel>
</apex:page>