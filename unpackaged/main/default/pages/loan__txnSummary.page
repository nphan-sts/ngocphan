<apex:page lightningStylesheets="true" standardController="loan__Loan_Account__c"
	extensions="loan.LoanTxnSummaryController" id="txnSummaryPage"
	sidebar="{!IF($CurrentPage.Parameters.modal == 'true', false, true)}">
<apex:include pageName="clcommon__mintTheme"/>

	<apex:stylesheet value="{!$Resource.loan__MFIStyles}" />
	<apex:stylesheet value="{!IF($CurrentPage.Parameters.modal == 'true', $Resource.loan__modalheaderStyle,'')}" />
	<script type="text/javascript" src="{!$Resource.PageScroll}"></script>
	<script
		src="{!URLFOR($Resource.jQueryFiles, 'js/jquery-1.8.3.min.js')}" />
	<script src="{!URLFOR($Resource.helperclose)}" />
	<script>
       j$ = jQuery.noConflict();
</script>
	<script>
        function setFocusOnLoad(){}
         
         
        function confirmCancel() {
            var isConfirm = confirm("Are you sure you want to cancel?");
            if(isConfirm){
                return this.parent.parent.window.close();
            }
        }
        function pageScroll(){
            window.scrollBy(0,10);
            scrolldelay = setTimeout('pageScroll()',10); // scrolls every 10 milliseconds
        }

        function stopScroll(){
            clearTimeout(scrolldelay);
        }
     </script>

	<apex:sectionHeader title="Transaction history for the loan: {!loan__Loan_Account__c.Name}" />
	<apex:outputPanel styleClass="mint-lightning-wrapper mint-lightning-wrapper-center">
		<apex:form >
			<apex:pageblock id="dateBlock" mode="edit">
				<apex:pageblockSection title="Search Transactions" columns="2">
					<apex:inputField value="{!search.loan__Start_Date__c}" />
					<apex:inputField value="{!search.loan__End_Date__c}" />
					</apex:pageBlockSection>

					<apex:pageBlockButtons location="bottom">
						<c:BusyButton name="Search" busyName="Searching"
							actionTo="{!getSummaryList}" style="margin-left:150px" />
					</apex:pageBlockButtons>

					</apex:pageBlock>

					<apex:pageBlock id="txnSummaryPBId" mode="edit">
						<apex:pageMessages />
						<apex:pageBlockButtons location="top" id="buttonsBlock">
							<apex:commandButton value="Cancel" immediate="true"
								action="{!URLFOR($Action.Loan_Account__c.View,Loan_Account__c.Id)}"
								onclick="closeIframe()" style="margin-left:150px" />
							<!--  
                   <c:BusyButton name="Reverse" busyname="Reversing..." actionTo="{!previewReversal}"
                      reRenderTo="previewReversalPanel"
                      disabled="{!NOT(enableReverse)}"
                      style="margin-left:5px;"/>
                   -->
						</apex:pageBlockButtons>

						<apex:outputpanel id="txnSummaryPanel">
							<apex:pageblockTable value="{!txnList}" id="txnTable" var="JA"
								headerClass="tableRight" styleClass="tableRight">
								<!--  <apex:column headerValue="Reverse" >
                     		<apex:inputCheckbox value="{!JA.selected}">
                     			<apex:actionSupport action="{!enableReverseButton}" rerender="txnSummaryPBId,buttonsBlock" event="onchange"/>
                     		</apex:inputCheckbox>
                     	</apex:column>
                     	-->
								<apex:column headerValue="Transaction Type" width="20%"
									headerClass="tableLeft" styleClass="tableLeft">
									<apex:commandLink value="{!JA.txn.loan__Transaction_Type__c}"
										reRender="txnSummaryDetail" status="TransactionLoad">
										<apex:param name="txnID" value="{!JA.txn.loan__Transaction_Id__c}" />
									</apex:commandLink>
									<!--<c:modalSpinner statusText="Loading ...."/>-->
								</apex:column>
								<apex:column headerValue="Transaction Date"
									value="{!JA.txn.loan__Txn_Date__c}" headerClass="tableLeft"
									styleClass="tableLeft" />
								<apex:column headerValue="Principal"
									value="{!JA.txn.loan__Principal__c}" />
								<apex:column headerValue="Interest"
									value="{!JA.txn.loan__Interest__c}" />
								<apex:column headerValue="Fees" value="{!JA.txn.loan__Fees__c}" />
								<apex:column headerValue="Excess" value="{!JA.txn.loan__Excess__c}" />
								<apex:column headerValue="Interest Rate"
									value="{!JA.txn.loan__Interest_Rate__c}" />
								<apex:column headerValue="Txn Amt" value="{!JA.txn.loan__Txn_Amt__c}" />
                                
                                <!--Added by Nitin S. to show whether the transaction has been reversed or not on Transaction Summary Page -->
                                <apex:column headerValue="Reversed" value="{!JA.txn.loan__Reversed__c}" />
							</apex:pageblockTable>

						</apex:outputpanel>

						<apex:outputpanel id="previewReversalPanel"
							rendered="{!showPreview}">
							<apex:pageblock id="dateBlock" mode="edit">
								<apex:pageblockSection title="Preview - Following transactions will be reversed">
									<apex:pageblockTable value="{!txnsToReverse}"
										id="txnToReverseTable" var="JA" headerClass="tableRight"
										styleClass="tableRight">

										<apex:column headerValue="Transaction Type" width="20%"
											headerClass="tableLeft" styleClass="tableLeft">
											<apex:commandLink value="{!JA.loan__Transaction_Type__c}"
												reRender="txnSummaryDetail" status="TransactionLoad">
												<apex:param name="txnID" value="{!JA.loan__Transaction_Id__c}" />
											</apex:commandLink>
										</apex:column>

										<apex:column headerValue="Transaction Date"
											value="{!JA.loan__Txn_Date__c}" headerClass="tableLeft"
											styleClass="tableLeft" />
										<apex:column headerValue="Principal"
											value="{!JA.loan__Principal__c}" />
										<apex:column headerValue="Interest" value="{!JA.loan__Interest__c}" />
										<apex:column headerValue="Fees" value="{!JA.loan__Fees__c}" />
										<apex:column headerValue="Excess" value="{!JA.loan__Excess__c}" />
										<apex:column headerValue="Interest Rate"
											value="{!JA.loan__Interest_Rate__c}" />
										<apex:column headerValue="Txn Amt" value="{!JA.loan__Txn_Amt__c}" />
									</apex:pageblockTable>
									</apex:pageBlockSection>

									<apex:pageBlockButtons location="bottom">
										<c:BusyButton name="Confirm" busyName="Reversing.."
											actionTo="{!reverseTxn}" style="margin-left:150px" />
									</apex:pageBlockButtons>
					</apex:pageBlock>
					</apex:outputpanel>
					</apex:pageBlock>

					<center>
						<apex:actionStatus id="TransactionLoad">
							<apex:facet name="start">
								<apex:image value="/img/loading32.gif" style="height:15px;" />
							</apex:facet>
						</apex:actionStatus>
					</center>
					<apex:outputPanel id="txnSummaryDetail" onmouseover="stopScroll()">
						<apex:detail subject="{!$CurrentPage.parameters.txnID}"
							title="true" relatedList="false" inlineEdit="false"></apex:detail>
					</apex:outputPanel>
		</apex:form>

	</apex:outputPanel>
</apex:page>