<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>peer__Start_Meet</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Start Meet</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;https://www.moxtra.com/api/js/moxtra-latest.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/13.0/connection.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/10.0/apex.js&quot;)}

Moxtra.clientId = &apos;{!$Setup.peer__Meet_Configuration__c.peer__Client_Id__c}&apos;;
var retVal;

var appId = &apos;{!peer__Loan_Application__c.Id}&apos;;
var accountId = &apos;{!peer__Loan_Application__c.peer__BorrowerId__c}&apos;;
var binderId = &apos;{!peer__Loan_Application__c.peer__Binder_Id__c}&apos;;

if(binderId.length == 0){
binderId = sforce.apex.execute(&quot;peer.StartMeet&quot;,&quot;createBinder&quot;,{loanAppId:appId});
}
Moxtra.binder_Id = binderId;

var checker = sforce.apex.execute(&quot;peer.StartMeet&quot;,&quot;meetChecker&quot;,{binderId:binderId,loanAppId:appId});

var contactEmail = sforce.apex.execute(&quot;peer.StartMeet&quot;,&quot;emailChecker&quot;,{accountId:accountId});

var options = {
iframe: false,

success: function(event) {

retVal = sforce.apex.execute(&quot;peer.StartMeet&quot;,&quot;inviteUser&quot;,{appId:appId,accountId:accountId,sessionKey:event.session_key,sessionId:event.session_id});

if(retVal != &apos;1&apos;)
alert(retVal);
},
error: function(event) {
alert(&quot;error code: &quot; + event.error_code + &quot; message: &quot; + error_message);
},
save: function(event) {
alert(&quot;Meet saved on binder: &quot; + event.binder_id);
},
invite: function(event) {
alert(&quot;session key: &quot; + event.session_key + &quot; session id: &quot; + event.session_id);
},
invited: function(event) {
alert(&quot;session key: &quot; + event.session_key +&quot; session id: &quot; + event.session_id);
},
exit: function(event) {
//alert(&quot;Meet exit event: &quot; + event.action);
},
extension:{
&quot;css_file&quot;:
{
&quot;use&quot; : true
}
}
};

if(checker != &apos;1&apos;){
alert(checker);
}
else if(contactEmail != &apos;1&apos;){
if(confirm(&quot;Contact(s) &quot; + contactEmail + &quot; is(are) missing EmailId. Do you still wish to start meet?&quot;)){
Moxtra.meet(options);
}
}
else if(contactEmail == &apos;1&apos;){
Moxtra.meet(options);
}</url>
</WebLink>
